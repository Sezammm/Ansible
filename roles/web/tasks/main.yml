---
- name: Install Apache (httpd)
  ansible.builtin.yum:
    name:
      - httpd
    state: present

- name: Enable and start httpd
  ansible.builtin.service:
    name: httpd
    state: started
    enabled: true

- name: Open HTTP port in firewalld
  ansible.builtin.firewalld:
    service: http
    permanent: true
    immediate: true
    state: enabled

- name: Optionally open HTTPS port in firewalld
  ansible.builtin.firewalld:
    service: https
    permanent: true
    immediate: true
    state: enabled
  when: open_https | bool

- name: Deploy index.html from template
  ansible.builtin.template:
    src: index.html.j2
    dest: "{{ web_root }}/index.html"
    owner: apache
    group: apache
    mode: "0644"
  notify: restart httpd

- name: Ensure SELinux context on web root
  ansible.builtin.shell: |
    restorecon -Rv {{ web_root }} || true
  changed_when: false
